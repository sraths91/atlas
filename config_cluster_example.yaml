# Fleet Server Cluster Configuration Example
# Copy this file and customize for your environment

organization:
  name: "Your Company Name"

server:
  # Network configuration
  # Use 0.0.0.0 to listen on all interfaces
  host: "0.0.0.0"
  port: 8768
  
  # Agent authentication (same on all nodes)
  api_key: "CHANGE_THIS_API_KEY_12345"
  
  # Web UI authentication (same on all nodes)
  web_username: "admin"
  web_password: "CHANGE_THIS_PASSWORD"
  
  # Database configuration (shared across all nodes)
  # For cluster mode, use shared storage path
  db_path: "/mnt/fleet-cluster/fleet_data.sqlite3"
  
  # Database encryption (same key on all nodes)
  db_encryption_key: "CHANGE_THIS_FERNET_KEY"
  
  # Payload encryption (same key on all nodes)
  encryption_key: "CHANGE_THIS_AES_KEY"
  
  # Database settings
  history_size: 10000
  history_retention_days: 90

# SSL/TLS Configuration
ssl:
  cert_file: "/etc/fleet/certs/server.crt"
  key_file: "/etc/fleet/certs/server.key"

# Cluster Mode Configuration
cluster:
  # Enable cluster mode for high availability
  enabled: true
  
  # Cluster state backend
  # Options: redis (recommended), sqlite, file
  backend: "redis"
  
  # Optional: Specify node identification
  # If not set, auto-detected from hostname
  # hostname: "server-01.company.com"
  # node_id: "server-01"
  
  # Heartbeat configuration
  heartbeat_interval: 10  # Send heartbeat every 10 seconds
  node_timeout: 30  # Mark node inactive after 30 seconds without heartbeat
  
  # Redis configuration (if backend: redis)
  redis_host: "redis.company.com"
  redis_port: 6379
  redis_db: 0
  redis_password: "CHANGE_THIS_REDIS_PASSWORD"
  
  # Shared filesystem configuration (if backend: sqlite or file)
  # state_path: "/mnt/fleet-cluster/cluster-state.json"

# Shared Session Storage (required for cluster mode)
sessions:
  # Session storage backend
  # Options: redis (recommended), sqlite, file
  backend: "redis"
  
  # Session timeout (in seconds)
  ttl: 3600  # 1 hour
  
  # Redis configuration (recommended for production)
  redis:
    host: "redis.company.com"
    port: 6379
    db: 1  # Use different Redis DB than cluster state
    password: "CHANGE_THIS_REDIS_PASSWORD"
  
  # Alternative: SQLite with shared filesystem
  # backend: "sqlite"
  # db_path: "/mnt/fleet-cluster/sessions.db"
  
  # Alternative: File-based (development only)
  # backend: "file"
  # session_dir: "/mnt/fleet-cluster/sessions"

# Monitoring (optional)
monitoring:
  enabled: true
  # Prometheus metrics port
  metrics_port: 9090

# Logging
logging:
  level: "INFO"  # DEBUG, INFO, WARNING, ERROR
  file: "/var/log/fleet-server.log"
  max_size: 10485760  # 10MB
  backup_count: 5

# Notes:
# 1. All nodes in the cluster must use the SAME:
#    - api_key
#    - db_path (shared storage)
#    - db_encryption_key
#    - encryption_key
#    - web_username and web_password
#    - session backend configuration
#
# 2. Each node should have UNIQUE:
#    - hostname (auto-detected)
#    - node_id (auto-generated if not set)
#
# 3. For production:
#    - Use Redis for cluster state and sessions
#    - Use shared network filesystem or PostgreSQL for database
#    - Enable SSL/TLS with valid certificates
#    - Use strong, unique passwords for all keys
#
# 4. Load Balancer Setup:
#    - Configure HAProxy or Nginx to distribute traffic
#    - Use /api/fleet/cluster/health for health checks
#    - Enable sticky sessions (optional but recommended)
